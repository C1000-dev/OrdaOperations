<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chats - ORDA</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .chat-wrapper{padding-top:80px;background:#000;min-height:100vh}
        .chat-container{display:grid;grid-template-columns:320px 1fr;height:calc(100vh - 80px);max-width:1600px;margin:0 auto;border:1px solid rgba(255,255,255,0.1)}
        .chat-list{background:#1a1a1a;border-right:2px solid rgba(255,255,255,0.1);overflow-y:auto}
        .chat-list-header{padding:25px;border-bottom:2px solid rgba(255,255,255,0.1);background:#0a0a0a}
        .chat-list-title{font-size:20px;font-weight:900;letter-spacing:2px}
        .chat-item{padding:20px;border-bottom:1px solid rgba(255,255,255,0.05);cursor:pointer;transition:all 0.2s}
        .chat-item:hover{background:rgba(255,255,255,0.03)}
        .chat-item.active{background:rgba(255,255,255,0.08);border-left:3px solid #fff}
        .chat-username{font-weight:700;font-size:16px;margin-bottom:5px}
        .chat-preview{font-size:13px;color:#666}
        .chat-main{display:flex;flex-direction:column;background:#0a0a0a}
        .chat-header{padding:25px;background:#1a1a1a;border-bottom:2px solid rgba(255,255,255,0.1)}
        .chat-header h2{font-size:22px;font-weight:900;letter-spacing:1px}
        .chat-messages{flex:1;padding:30px;overflow-y:auto;background:#0a0a0a}
        .message{margin-bottom:25px;display:flex;flex-direction:column;max-width:70%}
        .message.own{align-items:flex-end;margin-left:auto}
        .message-bubble{padding:15px 20px;background:#1a1a1a;border-radius:12px;word-wrap:break-word}
        .message.own .message-bubble{background:#333}
        .message-sender{font-weight:700;font-size:13px;margin-bottom:8px;color:#888}
        .message-text{font-size:15px;line-height:1.6}
        .message-time{font-size:11px;color:#555;margin-top:8px}
        .chat-input-area{padding:25px;background:#1a1a1a;border-top:2px solid rgba(255,255,255,0.1);display:flex;gap:15px}
        .chat-input{flex:1;padding:18px;background:#0a0a0a;border:2px solid rgba(255,255,255,0.2);color:#fff;font-size:15px;outline:none;border-radius:8px;font-family:inherit}
        .chat-input:focus{border-color:#fff}
        .send-btn{padding:18px 40px;background:#fff;color:#000;border:none;font-weight:700;cursor:pointer;border-radius:8px;letter-spacing:1.5px;transition:all 0.3s;font-size:14px}
        .send-btn:hover{background:#000;color:#fff;outline:2px solid #fff}
        .no-chat{display:flex;align-items:center;justify-content:center;height:100%;color:#666;font-size:18px;text-align:center;padding:40px;flex-direction:column}
        .no-chat-icon{font-size:64px;margin-bottom:20px;opacity:0.3}
        @media (max-width:968px){
            .chat-container{grid-template-columns:1fr}
            .chat-list{display:none}
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <img src="logo-transparent.png" alt="ORDA" class="nav-logo-img">
                <span class="logo-text">ORDER OF RUTHLESS DOMINION AND AUTHORITY</span>
            </div>
            <button class="mobile-menu-toggle" id="mobile-menu-toggle">
                <span></span><span></span><span></span>
            </button>
            <ul class="nav-menu" id="nav-menu">
                <li><a href="index-UPDATED.html#about">ABOUT</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle">FEATURES ‚ñæ</a>
                    <ul class="dropdown-menu">
                        <li><a href="games-UPDATED.html">GAMES</a></li>
                        <li><a href="ranks-UPDATED.html">RANKS</a></li>
                        <li><a href="ratings-UPDATED.html">RATINGS</a></li>
                    </ul>
                </li>
                <li><a href="hall-of-shame-COMPLETE.html" class="nav-rainbow">HALL OF SHAME</a></li>
                <li class="dropdown members-only">
                    <a href="#" class="dropdown-toggle">COMMUNICATIONS ‚ñæ</a>
                    <ul class="dropdown-menu">
                        <li><a href="members-FIXED.html">üîç Search Members</a></li>
                        <li><a href="chats-UPDATED.html">üí¨ Chats</a></li>
                    </ul>
                </li>
            </ul>
            <div class="nav-buttons">
                <a href="login-UPDATED.html" class="nav-signin">SIGN IN</a>
                <a href="https://discord.gg/hePEwEnukn" target="_blank" class="nav-button">JOIN SERVER</a>
            </div>
        </div>
    </nav>

    <div class="chat-wrapper">
        <div class="chat-container">
            <div class="chat-list">
                <div class="chat-list-header">
                    <div class="chat-list-title">MESSAGES</div>
                </div>
                <div id="chat-list"></div>
            </div>
            <div class="chat-main">
                <div class="chat-header" id="chat-header" style="display:none">
                    <h2 id="chat-with-name"></h2>
                </div>
                <div class="chat-messages" id="messages">
                    <div class="no-chat">
                        <div class="no-chat-icon">üí¨</div>
                        <div>Select a member to start chatting</div>
                    </div>
                </div>
                <div class="chat-input-area" id="input-area" style="display:none">
                    <input type="text" class="chat-input" id="message-input" placeholder="Type a message..." onkeypress="if(event.key==='Enter')sendMessage()">
                    <button class="send-btn" onclick="sendMessage()">SEND</button>
                </div>
            </div>
        </div>
    </div>

    <script src="analytics.js"></script>
    <script src="auth-system.js"></script>
    <script src="live-viewers.js"></script>
    <script>
        trackPageView('chats');
        
        const currentUser=ORDAAuth.getCurrentUser();
        if(!currentUser){window.location.href='login-UPDATED.html'}
        
        const mobileMenuToggle=document.getElementById('mobile-menu-toggle');
        const navMenu=document.getElementById('nav-menu');
        if(mobileMenuToggle){
            mobileMenuToggle.addEventListener('click',function(){
                this.classList.toggle('active');
                navMenu.classList.toggle('active');
            });
        }
        
        const users=JSON.parse(localStorage.getItem('orda_users')||'{}');
        const chatList=document.getElementById('chat-list');
        
        for(const u in users){
            if(u!==currentUser){
                const item=document.createElement('div');
                item.className='chat-item';
                item.onclick=()=>openChat(u);
                item.innerHTML=`
                    <div class="chat-username">${u}</div>
                    <div class="chat-preview">Click to start chatting</div>
                `;
                chatList.appendChild(item);
            }
        }
        
        let activeChat=null;
        
        function openChat(user){
            activeChat=user;
            document.querySelectorAll('.chat-item').forEach(i=>i.classList.remove('active'));
            event.target.closest('.chat-item').classList.add('active');
            
            document.getElementById('chat-header').style.display='block';
            document.getElementById('input-area').style.display='flex';
            document.getElementById('chat-with-name').textContent=user;
            
            loadMessages();
        }
        
        function loadMessages(){
            const chats=JSON.parse(localStorage.getItem('orda_chats')||'{}');
            const key=[currentUser,activeChat].sort().join('_');
            const msgs=chats[key]||[];
            
            const container=document.getElementById('messages');
            if(msgs.length===0){
                container.innerHTML='<div class="no-chat"><div class="no-chat-icon">üí¨</div><div>No messages yet. Say hello!</div></div>';
            }else{
                container.innerHTML=msgs.map(m=>{
                    const time=new Date(m.timestamp).toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'});
                    return `
                        <div class="message ${m.from===currentUser?'own':''}">
                            <div class="message-bubble">
                                ${m.from!==currentUser?`<div class="message-sender">${m.from}</div>`:''}
                                <div class="message-text">${m.text}</div>
                                <div class="message-time">${time}</div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            container.scrollTop=container.scrollHeight;
        }
        
        function sendMessage(){
            const input=document.getElementById('message-input');
            const text=input.value.trim();
            if(!text||!activeChat)return;
            
            const chats=JSON.parse(localStorage.getItem('orda_chats')||'{}');
            const key=[currentUser,activeChat].sort().join('_');
            if(!chats[key])chats[key]=[];
            
            chats[key].push({
                from:currentUser,
                text:text,
                timestamp:Date.now()
            });
            
            localStorage.setItem('orda_chats',JSON.stringify(chats));
            input.value='';
            loadMessages();
        }
    </script>
</body>
</html>
